/* ==UserStyle==
@name         Dark-WhatsApp
@description  Dark and light, very customizable theme for WhatsApp.
@namespace    github.com/vednoc/dark-whatsapp
@homepageURL  https://github.com/vednoc/dark-whatsapp
@supportURL   https://github.com/vednoc/dark-whatsapp/issues
@updateURL    https://raw.githubusercontent.com/vednoc/dark-whatsapp/master/wa.user.styl
@author       vednoc <vednoc@pm.me> (https://github.com/vednoc)
@version      3.0.0-rc.1
@license      MIT
@preprocessor stylus

@var select   theme      'Base color-scheme toggle' {
    'Custom colors   *': 'custom',
    'Dark blue (old)  ': 'old',
    'Dark gray (new)  ': 'new',
}
@var color    next_bg    '[Dev]: Base background color ' #1f232a
@var color    next_fg    '[Dev]: Base foreground color ' #eeeeee
@var color    next_ac    '[Dev]: Base accent color     ' #7289da
@var range    next_bg_a  '[Dev]: Adjust tones for background color' [0, -25, 25, 0.1, '%']
@var checkbox ow_imsg    'Override incoming message bubble color' 0
@var color    next_imsg  '[Dev]: Incoming message bubble color' #16191e
@var checkbox ow_omsg    'Override outgoing message bubble color' 0
@var color    next_omsg  '[Dev]: Outgoing message bubble color' #3b4250

@var text     ui_font    'Custom UI font' ''font_name''
@var text     radius-g   'Custom rounded corners for menus' 4px
@var text     radius-i   'Custom rounded corners for input area' 24px
@var range    radius-a   'Custom rounded corners for avatars' [50, 0, 50, 1, '%']
@var text     app_width  'Custom width for chat app' 1396px
@var checkbox fullscreen 'Enable fullscreen mode' 0
@var checkbox app_c_m    'Enable compact mode' 1
@var text     app_c_m_w  'Compact mode breakpoint' 720px
@var text     app_c_m_h  'Compact mode hover-on delay' 0.6s
@var text     app_c_m_d  'Compact mode hover-off delay' 1.2s

@var checkbox chat_b_c   'Enable blurred contacts' 0
@var checkbox app_c_h    'Enable consistent drawer headers' 1
@var select   alerts     'Alerts' {
    'Show all                   *': 'show          ',
    'Hide "Allow notifications"  ': 'notifications ',
    'Hide all                    ': 'hide          ',
}

@var select   app_image  'Custom app background' {
    'Theme image with 12px blur   *': 'bg-high ',
    'Theme image with 6px blur     ': 'bg-low  ',
    'Theme image without blur      ': 'bg-none ',
    'Custom background image       ': 'custom  ',
    'Default background            ': 'default ',
    'None                          ': 'none    ',
}

@var text     image_url  'Custom background image link' url('https://images.unsplash.com/photo-1434569117012-ce134ee1a088?fit=crop&w=1280&h=720&q=80')
@var range    bg_opacity 'Background image opacity' [0.4, 0.0, 1, 0.01]
@var range    bg_blur    'Background image blur size' [0, 0, 50, 1, 'px']
@var range    bg_hue     'Background image hue' [320, 0, 360, 1, 'deg']
@var range    bg_invert  'Background image invert colors' [0, 0.0, 1, 0.01]
@var text     bg_size    'Background image size' cover
@var text     bg_pos     'Background image position' center
@var text     bg_rep     'Background image repeat' no-repeat

@var range    emoji_o    'Emoji default opacity' [0.8, 0.0, 1, 0.01]

@var checkbox ff_scroll  'Thin scrollbars in Firefox' 1

@var checkbox chat_bg    'Enable chat background image' 1
@var text     chat_image 'Custom image for chat' url('https://web.whatsapp.com/img/bg-chat-tile_9e8a2898faedb7db9bf5638405cf81ae.png')
@var range    chat_bg_o  'Chat background image opacity' [0.15, 0.0, 1, 0.01]
@var range    chat_bg_iv 'Chat background image inverted colors' [0.6, 0.0, 1, 0.01]
@var text     chat_bg_s  'Chat background image size' initial
@var text     chat_bg_p  'Chat background image position' top left
@var text     chat_bg_r  'Chat background image repeat' repeat

@var checkbox rtl_header 'RTL: Remove empty message header' 1
@var checkbox rtl_format 'RTL: Fix formatting for message content' 1

@var checkbox c_g_c      'Theme colors for replies and group members' 1

@var checkbox bubble_in  'Swap sides for incoming message bubbles' 0
@var checkbox bubble_out 'Swap sides for outgoing message bubbles' 0

@var select   tail_style 'Style for message bubble tails' {
    'Default  *': 'default ',
    'Minimal   ': 'minimal ',
    'Rounded   ': 'rounded ',
    'Facebook  ': 'fb-like ',
}
@var checkbox fb_compact 'Collapse messages when `fb-like` tail style and `RTL` tweaks are enabled' 1
@var checkbox emoji_b    'Decrease height of big emojis when `fb-like` tail style and `RTL` tweaks are acctive' 1

@var checkbox chat_b_img 'Enable blurred images/videos' 0
@var text     chat_b_in  'Images/videos hover-on delay' 0.4s
@var text     chat_b_out 'Images/videos hover-off delay' 0.2s

@var color    _dark      'Color: Primary background   ' #1f232a
@var color    _darken    'Color: Highlight background ' #252A33
@var color    darker     'Color: Secondary background ' #333943
@var color    light      'Color: Primary foreground   ' #e9e9e9
@var color    lighter    'Color: Secondary foreground ' #a1a1a1
@var color    accent     'Color: Accent               ' #7289da
@var color    yellow     'Color: Yellow               ' #e5c512
@var color    orange     'Color: Orange               ' #df4b16
@var color    red        'Color: Red                  ' #dc322f
@var color    magenta    'Color: Magenta              ' #f33682
@var color    violet     'Color: Violet               ' #6c71c4
@var color    blue       'Color: Blue                 ' #268bd2
@var color    cyan       'Color: Cyan                 ' #2aa198
@var color    green      'Color: Green                ' #859900
@var color    white      'Color: White                ' #ffffff
@var color    sh         'Color: Shadow light         ' #00000025
@var color    sh-h       'Color: Shadow heavy         ' #00000035
==/UserStyle== */

// Color mixin.
/// All colors: `c: fg bd bg`
/// Only border-color: `c: 0 bd`
c(x, y = 0, z = 0, xi = 1, yi = 1, zi = 1) {
    i = !important;
    if x is a 'call' or x is a 'rgba' {            color: xi is 0? x : x i }
    if y is a 'call' or y is a 'rgba' {     border-color: yi is 0? y : y i }
    if z is a 'call' or z is a 'rgba' { background-color: zi is 0? z : z i }
}

// Raw RGB mixin.
/// Convert HEX to raw rrr-ggg-bbb format.
to_rgb(input) {
    unquote(slice(s('%s', rgba(input, 0)), 5, -3))
}

// Raw RGBA mixin.
/// Combine `*-rgb` vars and alpha value.
to_rgba(input, alpha) {
    unquote(s('rgba(var(--%s-rgb), %s)', unquote(input), alpha))
}

// Convert to SVG-friendly colors.
to_svg(input) {
    s('\%23%s', unquote(substr(s('%s', input), 1, 6)));
}

// Rounded corners.
rad() { border-radius: arguments }

/// Remove browser prefixes.
vendors = official

/// Feat -> Base color-scheme toggle. #32
if (theme == 'custom') {
    BG = next_bg
    FG = next_fg
    AC = next_ac
} else if (theme == 'old') {
    BG = #1f232a
    FG = #eeeeee
    AC = #7289da
} else if (theme == 'new') {
    BG = #292929
    FG = #e6e6e6
    AC = #d47d3f
}

/// Helper variables.
t  = transparent
i  = !important
_d = darken
_l = lighten
BA = next_bg_a
IM = next_imsg
OM = next_omsg

// Color generator.
/// TODO: Needs more polish.
if(dark(BG)) {
    a1 =  10%; a2 =  20%; a3 =  30%; a4 =  78%; a5 =  88%;
    b1 = (BA + 10); b2 = (BA - 5); b3 = (BA - 10); b4 = (BA - 15); b5 = (BA - 20)
    f1 = -10%; f2 =  10%; f3 =  20%; f4 =  30%; f5 =  40%;
} else {
    a1 =  10%; a2 =  15%; a3 =  30%; a4 =  60%; a5 =  70%;
    b1 = -10%; b2 =  08%; b3 =  16%; b4 =  24%; b5 =  32%;
    f1 = -05%; f2 = -10%; f3 = -15%; f4 = -20%; f5 = -30%;
}

// Feat -> Custom colors for message bubble.
in_msg_quote  = dark(IM) ? -10% : 25%
out_msg_quote = dark(OM) ? -10% : 25%

// Generate tones for base colors.
bg_hash = {
    '-0': _d(BG, b1),
    '-1': _d(BG, 0%),
    '-2': _d(BG, b2),
    '-3': _d(BG, b3),
    '-4': _d(BG, b4),
    '-5': _d(BG, b5),
}
fg_hash = {
    '-0': _d(FG, f1),
    '-1': _d(FG, 0%),
    '-2': _d(FG, f2),
    '-3': _d(FG, f3),
    '-4': _d(FG, f4),
    '-5': _d(FG, f5),
}
ac_hash = {
    '-0':                 AC,
    '-1': mix(_d(BG, -4), AC, a1),
    '-2': mix(_d(BG, -4), AC, a2),
    '-3': mix(_d(BG, -4), AC, a3),
    '-4': mix(_d(BG, -4), AC, a4),
    '-5': mix(_d(BG, -4), AC, a5),
}
msg-in  = {
    '-0':    IM,
    '-1': _d(IM, in_msg_quote),
}
msg-out = {
    '-0':    OM,
    '-1': _d(OM, out_msg_quote),
}

// Generate stylus-lang variables.
define('bg'      + key, val) for key, val in bg_hash
define('fg'      + key, val) for key, val in fg_hash
define('ac'      + key, val) for key, val in ac_hash
define('msg-out' + key, val) for key, val in msg-out
define('msg-in'  + key, val) for key, val in msg-in

// Stylus-lang helpers for CSS variables.
bg0 = var(--bg-0)
bg1 = var(--bg-1)
bg2 = var(--bg-2)
bg3 = var(--bg-3)
bg4 = var(--bg-4)
bg5 = var(--bg-5)
fg0 = var(--fg-0)
fg1 = var(--fg-1)
fg2 = var(--fg-2)
fg3 = var(--fg-3)
fg4 = var(--fg-4)
fg5 = var(--fg-5)
ac0 = var(--ac-0)
ac1 = var(--ac-1)
ac2 = var(--ac-2)
ac3 = var(--ac-3)
ac4 = var(--ac-4)
ac5 = var(--ac-5)

@-moz-document domain('web.whatsapp.com') {
    :root:not(#z), .dark:not(#z) {
        /// Userstyle info and announcements.
        --version: 'Dark-WhatsApp 3.0.0-rc.1 — August 1st, 2020'
        --message: 'The v3 is almost here! It will be released in a week ' + \
                   'from now. This update is here to let you know about ' + \
                   'upcoming changes – see the changelog for more info. '

        /// Custom UI font.
        --ui-font: ui_font, Segoe UI, Helvetica Neue, Helvetica, Lucida Grande,
                   Arial, Ubuntu, Cantarell, Fira Sans, sans-serif i

        /// Rounded corners.
        --r-menus:   radius-g
        --r-inputs:  radius-i
        --r-avatars: radius-a

        /// Compact mode.
        --c-m-hover: app_c_m_h
        --c-m-delay: app_c_m_d

        /// Blurred images/videos.
        --blur-in:  chat_b_in
        --blur-out: chat_b_out

        /// Custom app width.
        --app-width: app_width

        /// Custom emoji opacity.
        --emoji-o: emoji_o

        /// Custom app background.
        image_path  = 'https://raw.githubusercontent.com/'
        image_path += 'vednoc/dark-whatsapp/master/images/bg-blur'
        if ( app_image == bg-high ) {
            --bg-image: url(image_path + '-high.jpg')
        } else if ( app_image == bg-low ) {
            --bg-image: url(image_path + '-low.jpg')
        } else if ( app_image == bg-none ) {
            --bg-image: url(image_path + '-none.jpg')
        } else if ( app_image == custom ) {
            --bg-image: image_url
        } else {
            --bg-image: none
        }
        --bg-opacity: bg_opacity
        --bg-blur:    bg_blur
        --bg-blur-s:  calc(-2 * var(--bg-blur))
        --bg-hue:     bg_hue
        --bg-invert:  bg_invert
        --bg-size:    bg_size
        --bg-pos:     bg_pos
        --bg-rep:     bg_rep

        /// Custom chat background.
        --chat-image: chat_image
        --chat-bg-o:  chat_bg_o
        --chat-bg-i:  chat_bg_iv
        --chat-bg-s:  chat_bg_s
        --chat-bg-p:  chat_bg_p
        --chat-bg-r:  chat_bg_r

        /// Override incoming message bubble colors.
        if (ow_imsg) {
            --msg-in-0:     msg-in-0 i
            --msg-in-0-rgb: to_rgb(msg-in-0)
            --msg-in-1:     msg-in-1 i
            --msg-in-1-rgb: to_rgb(msg-in-1)
        } else {
            --msg-in-0:     var(--bg-4)
            --msg-in-0-rgb: var(--bg-4-rgb)
            --msg-in-1:     var(--bg-3)
            --msg-in-1-rgb: var(--bg-3-rgb)
        }

        /// Override outgoing message bubble colors.
        if (ow_omsg) {
            --msg-out-0:     msg-out-0 i
            --msg-out-0-rgb: to_rgb(msg-out-0)
            --msg-out-1:     msg-out-1 i
            --msg-out-1-rgb: to_rgb(msg-out-1)
        } else {
            --msg-out-0:     var(--ac-4)
            --msg-out-0-rgb: var(--ac-4-rgb)
            --msg-out-1:     var(--ac-5)
            --msg-out-1-rgb: var(--ac-5-rgb)
        }

        /// WA variables.
        --gray-30: var(--bg-5) //#f7f7f7;
        --gray-30-rgb: var(--bg-5-rgb) //247,247,247;
        --teal: var(--ac-0) //#009688;
        --teal-rgb: var(--ac-0-rgb) //0,150,136;
        --teal-light: var(--ac-1) //#1de9b6;
        --teal-light-rgb: var(--ac-1-rgb) //29,233,182;
        --teal-lighter: var(--ac-2) //#00bfa5;
        --teal-lighter-rgb: var(--ac-2) //0,191,165;
        --green-deep: var(--ac-3) //#1b9a59;
        --green-deep-rgb: var(--ac-3-rgb) //27,154,89;
        --active-tab-marker: var(--ac-0) //#00af9c;
        --active-tab-marker-rgb: var(--ac-0-rgb) //0,175,156;
        --app-background-stripe: var(--bg-1) //#091e1f;
        --app-background-stripe-rgb: var(--bg-1-rgb) //9,30,31;
        --app-background: var(--bg-0) //#080e12;
        --app-background-rgb: var(--bg-0-rgb) //8,14,18;
        --app-background-deeper: var(--bg-0) //#080e12;
        --app-background-deeper-rgb: var(--bg-0-rgb) //8,14,18;
        --attach-media-drop-border: var(--fg-3) //#f1f1f233;
        --attach-media-drop-border-rgb: var(--fg-3-rgb) //241,241,242;
        --attach-media-drop-overlay: var(--bg-2) //#383d3f4d;
        --attach-media-drop-overlay-rgb: var(--bg-2-rgb) //55.76,60.6,63.24;
        --audio-progress-incoming: var(--green) //#3bb463;
        --audio-progress-incoming-rgb: var(--green-rgb) //59,180,99;
        --audio-progress-outgoing: var(--ac-2) //#5f8884;
        --audio-progress-outgoing-rgb: var(--ac-2-rgb) //95,136,132;
        --audio-progress-played-incoming: var(--blue) //#5ba0c3;
        --audio-progress-played-incoming-rgb: var(--blue-rgb) //91,160,195;
        --audio-progress-played-outgoing: var(--blue) //#55a5c5;
        --audio-progress-played-outgoing-rgb: var(--blue-rgb) //85,165,197;
        --audio-track-incoming: var(--fg-4) //#374248;
        --audio-track-incoming-rgb: var(--fg-4-rgb) //55,66,72;
        --audio-track-outgoing: var(--fg-4) //#1d5852;
        --audio-track-outgoing-rgb: var(--fg-4-rgb) //29,88,82;
        --avatar-background: var(--bg-1) //#101d24;
        --avatar-background-rgb: var(--bg-1-rgb) //16,29,36;
        --avatar-border: var(--bg-3) //#a5aaad;
        --avatar-border-rgb: var(--bg-3-rgb) //165,170,173;
        --avatar-placeholder-background: var(--bg-5) //#6c7478;
        --avatar-placeholder-background-rgb: var(--bg-5-rgb) //108,116,120;
        --avatar-placeholder-primary: var(--fg-3) //#d6d8d9;
        --avatar-placeholder-primary-rgb: var(--fg-3-rgb) //214,216,217;
        --background-default: var(--bg-2) //#101d24;
        --background-default-rgb: var(--bg-2-rgb) //16,29,36;
        --background-default-active: var(--bg-4) //#202c32;
        --background-default-active-rgb: var(--bg-4-rgb) //32,44,50;
        --background-default-hover: var(--bg-3) //#17232a;
        --background-default-hover-rgb: var(--bg-3-rgb) //23,35,42;
        --border-bubble: var(--shadow) //#f1f1f20f;
        --border-bubble-rgb: var(--shadow-rgb) //241,241,242;
        --border-default: var(--bg-3) //#1b282e;
        --border-default-rgb: var(--bg-3-rgb) //27,40,46;
        --border-list: var(--bg-3) //#1b282e;
        --border-list-rgb: var(--bg-3-rgb) //27,40,46;
        --border-panel: var(--bg-5) //#28333a;
        --border-panel-rgb: var(--bg-5-rgb) //40,51,58;
        --border-strong: var(--bg-5) //#343f45;
        --border-strong-rgb: var(--bg-5-rgb) //52,63,69;
        --border-stronger: var(--bg-5) //#f1f1f20f;
        --border-stronger-rgb: var(--fg-5-rgb) //241,241,242;
        --bubble-meta: var(--fg-3) //#f1f1f299;
        --bubble-meta-rgb: var(--fg-3-rgb) //241,241,242;
        --bubble-meta-icon: var(--fg-3) //#f1f1f299;
        --bubble-meta-icon-rgb: var(--fg-3-rgb) //241,241,242;
        --butterbar-battery-background: mix(BG, red, 70%) //#e05b52;
        --butterbar-battery-background-rgb: to_rgb(mix(BG, red, 70%)) //224,91,82;
        --butterbar-battery-icon: var(--red) //#f5d6d7;
        --butterbar-battery-icon-rgb: var(--red-rgb) //245,214,215;
        --butterbar-battery-primary: var(--fg-0) //#f1f1f2f5;
        --butterbar-battery-primary-rgb: var(--fg-0-rgb) //241,241,242;
        --butterbar-battery-secondary: var(--fg-4) //#f1f1f2cc;
        --butterbar-battery-secondary-rgb: var(--fg-4-rgb) //241,241,242;
        --butterbar-connection-background: mix(BG, yellow, 75%) //#febc2c;
        --butterbar-connection-background-rgb: to_rgb(mix(BG, yellow, 75%)) //254,188,44;
        --butterbar-connection-primary: var(--fg-0) //#1c282ff5;
        --butterbar-connection-primary-rgb: var(--fg-0-rgb) //28,40,47;
        --butterbar-connection-secondary: var(--fg-4) //#1c282fd9;
        --butterbar-connection-secondary-rgb: var(--fg-4-rgb) //28,40,47;
        --butterbar-default-background: mix(BG, blue, 70%) //#39c;
        --butterbar-default-background-rgb: to_rgb(mix(BG, blue, 70%)) //51,153,204;
        --butterbar-icon: var(--bg-2) //#f1f1f2cc;
        --butterbar-icon-rgb: var(--bg-2-rgb) //241,241,242;
        --butterbar-notification-icon: var(--blue) //#8eb2be;
        --butterbar-notification-icon-rgb: var(--blue-rgb) //142,178,190;
        --butterbar-primary: var(--fg-0) //#f1f1f2f5;
        --butterbar-primary-rgb: var(--fg-0-rgb) //241,241,242;
        --butterbar-secondary: var(--fg-4) //#f1f1f2d9;
        --butterbar-secondary-rgb: var(--fg-4-rgb) //241,241,242;
        --butterbar-update-background: var(--ac-0) //#00af9c;
        --butterbar-update-background-rgb: var(--ac-0-rgb) //0,175,156;
        --butterbar-update-icon: var(--green) //#8eafaa;
        --butterbar-update-icon-rgb: var(--green-rgb) //142,175,170;
        --button-alternative: var(--ac-1) //#68bbe4;
        --button-alternative-rgb: var(--ac-1-rgb) //104,187,228;
        --button-alternative-background: var(--bg-3) //#222e35;
        --button-alternative-background-rgb: var(--bg-3-rgb) //34,46,53;
        --button-background-disabled: var(--bg-2) //#253137;
        --button-background-disabled-rgb: var(--bg-2-rgb) //37,49,55;
        --button-bubble: var(--ac-0) //#00af9cb3;
        --button-bubble-rgb: var(--ac-0-rgb) //0,175,156;
        --button-plain-background: var(--bg-4) //#2f3437;
        --button-plain-background-rgb: var(--bg-4-rgb) //47.1,51.86667,54.9;
        --button-primary: var(--white) //#101d24;
        --button-primary-rgb: var(--white-rgb) //16,29,36;
        --button-primary-background: var(--ac-0) //#00af9c;
        --button-primary-background-rgb: var(--ac-0-rgb) //0,175,156;
        --button-primary-background-hover: var(--ac-3) //#00c3ae;
        --button-primary-background-hover-rgb: var(--ac-3-rgb) //0,195.4,174.18514;
        --button-round-background: var(--ac-0) //#00af9c;
        --button-round-background-rgb: var(--ac-0-rgb) //0,175,156;
        --button-secondary: var(--ac-0) //#00af9c;
        --button-secondary-rgb: var(--ac-0-rgb) //0,175,156;
        --button-secondary-background: transparent;
        --button-secondary-background-rgb: 0,0,0;
        --button-secondary-background-hover: #f1f1f20d;
        --button-secondary-background-hover-rgb: var(--fg-3-rgb) //241,241,242;
        --button-secondary-hover: var(--ac-0) //#00af9c;
        --button-secondary-hover-rgb: var(--ac-0-rgb) //0,175,156;
        --chat-marker: var(--fg-3) //#999;
        --chat-marker-rgb: var(--fg-3-rgb) //153,153,153;
        --chat-marker-admin: var(--ac-0) //#00af9c;
        --chat-marker-admin-rgb: var(--ac-0-rgb) //0,175,156;
        --chat-marker-admin-border: var(--ac-0) //#00af9cb3;
        --chat-marker-admin-border-rgb: var(--ac-0-rgb) //0,175,156;
        --chat-marker-border: var(--fg-3) //#999999b3;
        --chat-marker-border-rgb: var(--fg-3-rgb) //153,153,153;
        --chatlist-icon: var(--fg-5) //#f1f1f299;
        --chatlist-icon-rgb: var(--fg-5-rgb) //241,241,242;
        --checkbox-background: var(--ac-0) //#00af9c;
        --checkbox-background-rgb: var(--ac-0-rgb) //0,175,156;
        --checkbox-mark: var(--white) //#101d24;
        --checkbox-mark-rgb: var(--white-rgb) //16,29,36;
        /// Old compose variables. TODO: Remove in the next update.
        --compose-background: var(--bg-1) //#101d24;
        --compose-background-rgb: var(--bg-1-rgb) //16,29,36;
        --compose-background-focused: var(--bg-0) //#203946;
        --compose-background-focused-rgb: var(--bg-0-rgb) //32,57,70;
        --compose-border: var(--bg-5) //#2f3437;
        --compose-border-rgb: var(--bg-5-rgb) //47.1,51.86667,54.9;
        --compose-border-focused: var(--bg-5) //#274656;
        --compose-border-focused-rgb: var(--bg-5-rgb) //39,70,86;
        --compose-panel-background: var(--bg-3) //#222e35;
        --compose-panel-background-rgb: var(--bg-3-rgb) //34,46,53;
        /// New compose variables.
        --compose-input-background-focused: var(--bg-0) //#3f5560;
        --compose-input-background-focused-rgb: var(--bg-0-rgb) //63,85,96;
        --compose-input-background: var(--bg-1) //#33383b;
        --compose-input-background-rgb: var(--bg-1-rgb) //51.22296,56.04619,58.67704;
        --compose-input-border: var(--bg-5) //#33383b;
        --compose-input-border-rgb: var(--bg-5-rgb) //51.22296,56.04619,58.67704;
        --compose-input-border-focused: var(--bg-5) //#415a67;
        --compose-input-border-focused-rgb: var(--bg-5-rgb) //65,90,103;
        --compose-panel-background: var(--bg-3) //#1e2428;
        --compose-panel-background-rgb: var(--bg-3-rgb) //29.591,36.36026,40.309;
        --compose-panel-background-hover: var(--bg-4) //#151e23;
        --compose-panel-background-hover-rgb: var(--ac-4-rgb) //21,30,35;
        --compose-primary: var(--fg-1) //#f1f1f2;
        --compose-primary-rgb: var(--fg-1-rgb) //241,241,242;
        --conversation-panel-background: var(--bg-1) //#0b1419;
        --conversation-panel-background-rgb: var(--bg-1-rgb) //11.29231,20.46731,25.40769;
        --conversation-panel-border: var(--bg-5) //#f1f1f214;
        --conversation-panel-border-rgb: var(--fg-3-rgb) //241,241,242;
        --danger: var(--red) //#ef697a;
        --danger-rgb: var(--red-rgb) //239,105,122;
        --drawer-background: var(--bg-1) //#101d24;
        --drawer-background-rgb: var(--bg-1-rgb) //16,29,36;
        --drawer-background-deep: var(--bg-0) //#080e12;
        --drawer-background-deep-rgb: var(--bg-0-rgb) //8,14,18;
        --drawer-gallery-background: var(--bg-1) //#101d24;
        --drawer-gallery-background-rgb: var(--bg-1-rgb) //16,29,36;
        --drawer-gallery-background-active: var(--bg-0) //#0d1418;
        --drawer-gallery-background-active-rgb: var(--bg-0-rgb) //13.12731,19.91681,23.57269;
        --drawer-gallery-background-hover: var(--bg-0) //#0d1418;
        --drawer-gallery-background-hover-rgb: var(--bg-0-rgb) //13.12731,19.91681,23.57269;
        --drawer-header-title: var(--fg-1) //#d6d8d9;
        --drawer-header-title-rgb: var(--fg-1-rgb) //214,216,217;
        --drawer-section-background: var(--bg-2) //#101d24;
        --drawer-section-background-rgb: var(--bg-2-rgb) //16,29,36;
        --dropdown-background: var(--bg-2) //#253137;
        --dropdown-background-rgb: var(--bg-2-rgb) //37,49,55;
        --dropdown-background-hover: var(--bg-3) //#202c33;
        --dropdown-background-hover-rgb: var(--bg-3-rgb) //32,44,51;
        --empty-state-background: var(--bg-3) //#1c282f;
        --empty-state-background-rgb: var(--bg-3-rgb) //28,40,47;
        --empty-state-icon: var(--fg-4) //#757c81;
        --empty-state-icon-rgb: var(--fg-4-rgb) //117,124,129;
        --focus: var(--ac-3) //#68bbe4;
        --focus-rgb: var(--ac-3-rgb) //104,187,228;
        --focus-animation: var(--ac-3) //#68bbe442;
        --focus-animation-rgb: var(--ac-3-rgb) //104,187,228;
        --focus-animation-deeper: var(--ac-3) //#68bbe452;
        --focus-animation-deeper-rgb: var(--ac-3-rgb) //104,187,228;
        --focus-lighter: var(--ac-3) //#68bbe41f;
        --focus-lighter-rgb: var(--ac-3-rgb) //104,187,228;
        --highlight: var(--ac-0) //#00af9c;
        --highlight-rgb: var(--ac-0-rgb) //0,175,156;
        --icon: var(--fg-3) //#80868b;
        --icon-rgb: var(--fg-3-rgb) //128,134,139;
        --icon-ack: var(--ac-0) //#34b7f1;
        --icon-ack-rgb: var(--ac-0-rgb) //52,183,241;
        --icon-disabled: var(--fg-5) //#3c464c;
        --icon-disabled-rgb: var(--fg-5-rgb) //60,70,76;
        --icon-fixed: var(--fg-3) //#80868b;
        --icon-fixed-rgb: var(--fg-3-rgb) //128,134,139;
        --icon-lighter: var(--fg-5) //#f1f1f245;
        --icon-lighter-rgb: var(--fg-0-rgb) //241,241,242;
        --icon-search-back: var(--ac-2) //#71787d;
        --icon-search-back-rgb: var(--ac-2-rgb) //113,120,125;
        --icon-strong: var(--fg-1) //#c4c7c9;
        --icon-strong-rgb: var(--fg-1-rgb) //196,199,201;
        --incoming-background: var(--msg-in-0) //#222e35;
        --incoming-background-rgb: var(--msg-in-0-rgb) //34,46,53;
        --incoming-background-deeper: var(--msg-in-1) //#1d272e;
        --incoming-background-deeper-rgb: var(--msg-in-1-rgb) //29,39,46;
        --incoming-background-highlight: #ccc;
        --incoming-background-highlight-rgb: 204,204,204;
        --incoming-primary: var(--fg-3) //#777d81;
        --incoming-primary-rgb: var(--fg-3-rgb) //119,125,129;
        --input-border-active: var(--ac-0) //#00af9c;
        --input-border-active-rgb: var(--ac-0-rgb) //0,175,156;
        --input-placeholder: var(--fg-4) //#6a7276;
        --input-placeholder-rgb: var(--fg-4) //106,114,118;
        --intro-background: var(--bg-1) //#222e35;
        --intro-background-rgb: var(--bg-1-rgb) //34,46,53;
        --intro-border: var(--ac-3) //#054740;
        --intro-border-rgb: var(--ac-3-rgb) //5,71,64;
        --intro-secondary: var(--fg-3) //#a6a8aa;
        --intro-secondary-rgb: var(--fg-3-rgb) //166,168,170;
        --inverse: #f1f1f2;
        --inverse-rgb: var(--fg-0-rgb) //241,241,242;
        --labels-icon: #f1f1f266;
        --labels-icon-rgb: var(--fg-3-rgb) //241,241,242;
        --link: var(--ac-0) //#68bbe4;
        --link-rgb: var(--ac-0-rgb) //104,187,228;
        --live-location-footer-background: var(--bg-1) //#101d24e6;
        --live-location-footer-background-rgb: var(--bg-1-rgb) //16,29,36;
        --live-location-glow: #25d3664d;
        --live-location-glow-rgb: 37,211,102;
        --live-location-glow-stale: #ff001f4d;
        --live-location-glow-stale-rgb: 255,0,31;
        --location-cluster-background: var(--bg-1) //#101d24;
        --location-cluster-background-rgb: var(--bg-1-rgb) //16,29,36;
        --media-editor-control: #1c313f;
        --media-editor-control-rgb: 28,49,63;
        --media-viewer-background: to_rgba('bg-1', 0.80) //#101d24fa;
        --media-viewer-background-rgb: var(--bg-1-rgb) //16,29,36;
        --media-viewer-button-background: var(--bg-3) //#1c282f;
        --media-viewer-button-background-rgb: var(--bg-3-rgb) //28,40,47;
        --media-viewer-button-icon: #f1f1f2;
        --media-viewer-button-icon-rgb: var(--fg-3-rgb) //241,241,242;
        --menu-tabs-list-active: var(--ac-0) //#00af9c;
        --menu-tabs-list-active-rgb: var(--ac-0-rgb) //0,175,156;
        --message-background-deep: var(--bg-0) //#080e1259;
        --message-background-deep-rgb: var(--bg-0-rgb) //8,14,18;
        --message-placeholder-icon: var(--fg-3) //#cccccc4d;
        --message-placeholder-icon-rgb: var(--fg-3-rgb) //204,204,204;
        --message-primary: var(--fg-1) //#f1f1f2f2;
        --message-primary-rgb: var(--fg-1-rgb) //241,241,242;
        --message-selection-highlight: to_rgba('ac-0', 0.1) //#f1f1f20d;
        --message-selection-highlight-rgb: var(--ac-0-rgb) //241,241,242;
        --modal-backdrop: to_rgba('bg-1', 0.70) //#080e12d9;
        --modal-backdrop-rgb: var(--bg-0-rgb) //8,14,18;
        --modal-backdrop-solid: var(--bg-0) //#1c282f;
        --modal-backdrop-solid-rgb: var(--bg-0-rgb) //28,40,47;
        --modal-background: var(--bg-2) //#364147;
        --modal-background-rgb: var(--bg-2-rgb) //54,65,71;
        --notification-biz-background: var(--bg-0) //#1c282f;
        --notification-biz-background-rgb: var(--bg-0-rgb) //28,40,47;
        --notification-biz-text: #55fad9;
        --notification-biz-text-rgb: 85,250,217;
        --notification-e2e-background: var(--bg-0) //#1c282f;
        --notification-e2e-background-rgb: var(--bg-3-rgb) //28,40,47;
        --notification-e2e-icon: #fad964;
        --notification-e2e-icon-rgb: 250,217,100;
        --notification-e2e-text: #fad964;
        --notification-e2e-text-rgb: 250,217,100;
        --notification-text: #f1f1f266;
        --notification-text-rgb: var(--fg-3-rgb) //241,241,242;
        --outgoing-background: var(--msg-out-0) //#054740;
        --outgoing-background-rgb: var(--msg-out-0-rgb) //5,71,64;
        --outgoing-background-deeper: var(--msg-out-1) //#063b36;
        --outgoing-background-deeper-rgb: var(--msg-out-1-rgb) //6,59,54;
        --outgoing-background-highlight: #ccc;
        --outgoing-background-highlight-rgb: 204,204,204;
        --overlay: var(--bg-0) //#080e12;
        --overlay-rgb: var(--bg-0-rgb) //8,14,18;
        --panel-background: var(--bg-3) //#1c282f;
        --panel-background-rgb: var(--bg-3-rgb) //28,40,47;
        --panel-background-active: #1a262d;
        --panel-background-active-rgb: 26,38,45;
        --panel-background-colored: var(--bg-3) //#222e35;
        --panel-background-colored-rgb: var(--bg-3-rgb) //34,46,53;
        --panel-background-colored-deeper: var(--bg-3) //#222e35;
        --panel-background-colored-deeper-rgb: var(--bg-3-rgb) //34,46,53;
        --panel-background-deep: var(--bg-2) //#162026;
        --panel-background-deep-rgb: var(--bg-2-rgb) //22,32,38;
        --panel-background-deeper: var(--bg-3) //#1a252c;
        --panel-background-deeper-rgb: var(--bg-3-rgb) //26,37,44;
        --panel-background-hover: var(--bg-4) //#1b272e;
        --panel-background-hover-rgb: var(--bg-4-rgb) //27,39,46;
        --panel-background-lighter: var(--bg-3) //#1a252c;
        --panel-background-lighter-rgb: var(--bg-3-rgb) //26,37,44;
        --panel-header-background: var(--bg-3) //#222e35;
        --panel-header-background-rgb: var(--bg-3-rgb) //34,46,53;
        --panel-header-icon: var(--fg-3) //#9ea3a6;
        --panel-header-icon-rgb: var(--fg-3-rgb) //158,163,166;
        --panel-input-background: var(--bg-2) //#262d31;
        --panel-input-background-rgb: var(--bg-2-rgb) //38.35,44.85526,48.65;
        --panel-primary: var(--fg-3) //#f1f1f259;
        --panel-primary-rgb: var(--fg-3-rgb) //241,241,242;
        --payment-amount: #00a593;
        --payment-amount-rgb: 0,164.8,146.90743;
        --payment-status-failed: #ef697a;
        --payment-status-failed-rgb: 239,105,122;
        --payment-status-processing: var(--fg-1) //#f1f1f273;
        --payment-status-processing-rgb: var(--fg-3-rgb) //241,241,242;
        --payment-status-success: #40cf6c;
        --payment-status-success-rgb: 64,207,108;
        --payment-status-waiting: var(--fg-1) //#f1f1f273;
        --payment-status-waiting-rgb: var(--fg-3-rgb) //241,241,242;
        --photopicker-overlay-background: to_rgba('bg-3', 0.8) //#212c31cc;
        --photopicker-overlay-background-rgb: var(--bg-3-rgb) //33,44,49;
        --popup-panel-background: var(--bg-2) //#080e1233;
        --popup-panel-background-rgb: var(--bg-2-rgb) //8,14,18;
        --primary: var(--fg-2) //#a5aaad;
        --primary-rgb: var(--fg-2-rgb) //165,170,173;
        --primary-strong: var(--fg-1) //#d4d5d7;
        --primary-strong-rgb: var(--fg-1-rgb) //212,213,215;
        --primary-stronger: var(--fg-0) //#f1f1f2de;
        --primary-stronger-rgb: var(--fg-0-rgb) //241,241,242;
        --primary-strongest: var(--fg-0) //#fff;
        --primary-strongest-rgb: var(--fg-0-rgb) //255,255,255;
        --primary-title: var(--fg-2) //#d4d5d7f7;
        --primary-title-rgb: var(--fg-2-rgb) //212,213,215;
        --product-thumb-background: var(--bg-3) //#1c282f;
        --product-thumb-background-rgb: var(--bg-3-rgb) //28,40,47;
        --product-thumb-background-deeper: var(--bg-2) //#2b3e49;
        --product-thumb-background-deeper-rgb: var(--bg-2-rgb) //43.232,61.76,72.568;
        --progress-background: var(--bg-2) //#2a2f32;
        --progress-background-rgb: var(--bg-2-rgb) //41.6,47.46667,50.4;
        --progress-primary: var(--ac-0) //#0c897c;
        --progress-primary-rgb: var(--ac-0) //12,137,124;
        --ptt-blue: var(--blue) //#4fc3f7;
        --ptt-blue-rgb: var(--blue-rgb) //79,195,247;
        --ptt-button-cancel: var(--red) //#e53935cc;
        --ptt-button-cancel-rgb: var(--red-rgb) //229,57,53;
        --ptt-button-send: var(--green) //#09d261cc;
        --ptt-button-send-rgb: var(--green) //9,210,97;
        --ptt-gray: var(--fg-4) //#f1f1f266;
        --ptt-gray-rgb: var(--fg-4-rgb) //241,241,242;
        --ptt-green: var(--green) //#09d261;
        --ptt-green-rgb: var(--green) //9,210,97;
        --ptt-message-blue: var(--blue) //#68bbe4;
        --ptt-message-blue-rgb: var(--blue-rgb) //104,187,228;
        --quick-action-button: to_rgba('fg-3', 0.5) //#f1f1f280;
        --quick-action-button-rgb: var(--fg-3-rgb) //241,241,242;
        --quick-action-button-background: var(--bg-4) //#080e1299;
        --quick-action-button-background-rgb: var(--bg-4-rgb) //8,14,18;
        --rich-text-panel-background: var(--bg-3) //#1c282f;
        --rich-text-panel-background-rgb: var(--bg-3-rgb) //28,40,47;
        --search-container-background: var(--bg-2) //#131c21;
        --search-container-background-rgb: var(--bg-2-rgb) //18.6,28.22,33.4;
        --search-input-background: var(--bg-3) //#2a2f32;
        --search-input-background-rgb: var(--bg-3-rgb) //41.6,47.46667,50.4;
        --secondary: var(--fg-3) //#f1f1f299;
        --secondary-rgb: var(--fg-3-rgb) //241,241,242;
        --secondary-light: var(--fg-2) //#f1f1f240;
        --secondary-light-rgb: var(--fg-2-rgb) //241,241,242;
        --secondary-lighter: var(--fg-3) //#f1f1f273;
        --secondary-lighter-rgb: var(--fg-3-rgb) //241,241,242;
        --secondary-stronger: var(--fg-3) //#f1f1f2cc;
        --secondary-stronger-rgb: var(--fg-3-rgb) //241,241,242;
        --shadow: var(--bg-0) //#000;
        --shadow-rgb: var(--bg-0-rgb) //0,0,0;
        --shadow-light: var(--bg-0) //#00000014;
        --shadow-light-rgb: var(--bg-0-rgb) //0,0,0;
        --spinner-default: var(--fg-3) //#75787a;
        --spinner-default-rgb: var(--fg-3-rgb) //117,120,122;
        --spinner-highlight: var(--ac-0) //#00af9c;
        --spinner-highlight-rgb: var(--ac-0-rgb) //0,175,156;
        --spinner-incoming: var(--fg-5) //#60696e;
        --spinner-incoming-rgb: var(--fg-5-rgb) //96,105,110;
        --spinner-outgoing: var(--ac-5) //#4c7a75;
        --spinner-outgoing-rgb: var(--ac-5-rgb) //76,122,117;
        --startup-background: var(--bg-0) //#131c21;
        --startup-background-rgb: var(--bg-0-rgb) //18.6,28.22,33.4;
        --status-background: var(--bg-1) //#000;
        --status-background-rgb: var(--bg-1-rgb) //0,0,0;
        --status-background-hover: var(--bg-2) //#242424;
        --status-background-hover-rgb: var(--bg-2-rgb) //36,36,36;
        --status-primary: var(--fg-1) //#fff;
        --status-primary-rgb: var(--fg-1-rgb) //255,255,255;
        --status-secondary: var(--fg-4) //#ffffff8c;
        --status-secondary-rgb: var(--fg-4-rgb) //255,255,255;
        --status-secondary-stronger: var(--fg-5) //#b3b3b3;
        --status-secondary-stronger-rgb: var(--fg-5-rgb) //179,179,179;
        --success: var(--ac-0) //#00af9c;
        --success-rgb: var(--ac-0-rgb) //0,175,156;
        --suspicious-background: #ef697acc;
        --suspicious-background-rgb: 239,105,122;
        --system-message-background: var(--ac-5) //#1e2a30;
        --system-message-background-rgb: var(--ac-5-rgb) //30,42,48;
        --system-message-text: to_rgba('fg-1', 0.87) //#f1f1f2de;
        --system-message-text-rgb: var(--fg-1-rgb) //241,241,242;
        --teal-hover: #00b7a1;
        --teal-hover-rgb: 0,183,161;
        --teal-pale: #5fc8bc;
        --teal-pale-rgb: 95,200,188;
        --thumb-border-active: var(--bg-2) //#75787a;
        --thumb-border-active-rgb: var(--bg-2-rgb) //117,120,122;
        --thumb-border-viewer-active: var(--fg-3) //#75787a;
        --thumb-border-viewer-active-rgb: var(--fg-3-rgb) //117,120,122;
        --toast-background: to_rgba('bg-3', 0.96) //#080e12f5;
        --toast-background-rgb: var(--bg-3-rgb) //8,14,18;
        --tooltip-background: to_rgba('bg-4', 0.85) //#595959d9;
        --tooltip-background-rgb: var(--bg-4) //89.25,89.25,89.25;
        --typing: var(--ac-0) //#00af9c;
        --typing-rgb: var(--ac-0-rgb) //0,175,156;
        --unread-background: var(--bg-3) //#1c282f;
        --unread-background-rgb: var(--bg-3-rgb) //28,40,47;
        --unread-bar-background: to_rgba('bg-0', 0.7) //#080e124d;
        --unread-bar-background-rgb: var(--bg-0-rgb) //8,14,18;
        --unread-marker-background: var(--ac-0) //#00af9c;
        --unread-marker-background-rgb: var(--ac-0-rgb) //0,175,156;
        --unread-marker-text: var(--white) //#101d24;
        --unread-marker-text-rgb: var(--white-rgb) //16,29,36;
        --video-player-background: #000;
        --video-player-background-rgb: 0,0,0;
        --video-primary: #fff;
        --video-primary-rgb: 255,255,255;
        --voip-accept-background: #70db91;
        --voip-accept-background-rgb: 112,219,145;
        --voip-background: #262626;
        --voip-background-rgb: 38,38,38;
        --voip-background-deep: #000;
        --voip-background-deep-rgb: 0,0,0;
        --voip-primary: #fff;
        --voip-primary-rgb: 255,255,255;
        --voip-reject-background: #e54b40;
        --voip-reject-background-rgb: 229,75,64;
        --win32-title-primary: #fff;
        --win32-title-primary-rgb: 255,255,255;

        /// DWA color variables.
        for _v in (bg fg ac) {
            for _i in 0..5 {
                var_key = '--' + _v + '-' + _i
                /// Escape `\` for `*-0` vars.
                var_val = _v + \- + _i

                /// Generate CSS variables.
                { var_key }: var_val i
                { var_key + '-rgb' }: to_rgb(var_val)
            }
        }

        /// TODO: Improve secondary colors.
        --white:      white
        --white-rgb:  to_rgb(white)
        --red:        red
        --red-rgb:    to_rgb(red)
        --green:      green
        --green-rgb:  to_rgb(green)
        --blue:       blue
        --blue-rgb:   to_rgb(blue)
        --yellow:     yellow
        --yellow-rgb: to_rgb(yellow)
        --t:          transparent
        --shadow:     sh
        --bshadow:    0 2px 4px var(--shadow)

        /// Theme intro colors.
        svg_bg = to_svg(bg-1)
        svg_ac = to_svg(ac-0)

        /// Theme intro image.
        _1  = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' "
        _1 += "height='256' width='256'><g stroke='"
        _2  = "'><path d='M128.4901 30.8659a95.4375 95.4375 0 00-95.4375 95.4375"
        _2 += " 95.4375 95.4375 0 0014.168 50.0332L35.6698 221.276l44.7989-12.49"
        _2 += "8a95.4375 95.4375 0 0048.0214 12.9629 95.4375 95.4375 0 0095.4375"
        _2 += "-95.4375 95.4375 95.4375 0 00-95.4375-95.4375z' fill='"
        _3  = "' fill-rule='evenodd' stroke-width='18' stroke-linecap='square'/>"
        _3 += "<path d='M97.8104 79.8463c-4.9671.0406-13.5028 2.0796-17.7812 14."
        _3 += "8946-6.8318 20.4631 12.5737 43.3028 27.2438 57.4735 14.7975 14.29"
        _3 += "38 43.1559 26.507 58.0098 21.08 20.5566-8.9065 15.2475-22.9479 15"
        _3 += ".2475-22.9479l-22.9727-11.0878s-2.062-1.206-3.4146.5737c-1.0042 1"
        _3 += ".3213-9.4409 11.3755-9.4409 11.3755s-1.449 1.668-3.827.7402c-5.75"
        _3 += "74-2.2462-14.2018-7.4856-18.5314-10.7795-6.8875-5.2399-12.957-13."
        _3 += "0846-16.9473-19.668-1.2556-2.5597.6953-4.709.6953-4.709s6.0303-8."
        _3 += "2629 7.0176-9.5566c1.0068-1.3194.2539-3.3633.2539-3.3633l-10.539-"
        _3 += "23.2285s-2.0334-.8212-5.0138-.7969z' fill='"
        _4  = "' stroke-linejoin='round'/></g></svg>"
        _i = s('url("%s%s%s%s%s%s%s")', unquote(_1), svg_ac, unquote(_2), svg_bg,
                                        unquote(_3), svg_ac, unquote(_4))
        --intro-image: _i
    }

    /// Animation for 'typing...' indicator.
    @keyframes pulse {
        40% { opacity: 0 }
        80% { opacity: 1 }
    }

    // Global styles.
    html > body {
        background-image: none i
        c: fg0 0 bg0

        option { c: fg1 0 bg3 }

        /// Feat -> Custom font.
        &, button, input { font-family: var(--ui-font) }

        /// Toast notifications.
        ._11dpe {
            c: fg1
            border: 1px solid bg5 i
            button:nth-child(2) { c: ac1 }
            button:nth-child(3) { c: fg4 }
        }

        /// Intro image.
        [data-asset-intro-image-dark], [data-asset-intro-image-light] {
            max-width: 240px
            max-height: 240px
            background-image: var(--intro-image)
            transition: opacity 0.6s ease
            rad: 0 i

            /// Title.
            + div h1 { c: fg0 }

            /// Custom text.
            + div h1 + div[class] {
                font-size: 0 i
                c: fg1

                /// Announcements.
                &::before {
                    display: block
                    font-size: 16px
                    margin-bottom: -16px
                    white-space: pre-wrap
                    content: var(--message) var(--changes)
                }

                /// Version.
                &::after {
                    display: block
                    font-size: 16px
                    margin-top: 16px
                    padding-top: 24px
                    margin-bottom: -16px
                    content: var(--version)
                    border-top: 1px solid bg4 i
                }
            }
        }

        /// Settings -> Tweaks for 'Set Chat Wallpaper' area. #149
        /[style *= 'd-color: rgb(237\, 233\, 228)'] {
            position: relative
            c: 0 0 bg1

            /// Override selected wallpaper.
            --blue-light: ac3
            --inverse: ac3

            /// Add pseudo text.
            &::before {
                content: ''
                filter: invert(var(--chat-bg-i)) opacity(var(--chat-bg-o))
                background: var(--chat-image) i
                position: absolute
                height: 100%
                width: 100%
            }

            /// Expand default chat wallpaper.
            &:first-child {
                border: 4px solid bg3 i
                &, &::after { width: calc(3 * 82px + 30px) i }
                span {
                    font-size: 0 i
                    &::before {
                        content: 'Use this with Dark-WhatsApp'
                        font-size: 16px i
                    }
                }
            }

            /// Override light gray wallpapers.
            /[style *= 'rgb(222\, 227\, 233)'],
            /[style *= 'rgb(217\, 218\, 222)'],
            /[style *= 'rgb(192\, 193\, 196)'] {
                border: 4px solid bg3 i
                c: 0 0 bg1
            }
        }

        /// Global -> Scrollbar styles.
        /\*{
            /// Feat -> Thin scrollbar in Firefox.
            if (ff_scroll) {
                @supports (scrollbar-width: thin) {
                    scrollbar-width: thin i
                }
            }

            /// Scrollbar colors.
            @supports (scrollbar-width: thin) {
                scrollbar-color: ac3 #88888810 i
            }
            &::-webkit-scrollbar {
                &-thumb { c: 0 0 ac-3 i }
                &-track { c: 0 0 var(--shadow) i }
            }
        }
    }

    // Feat -> Rounded corners for avatars.
    ._1BjNO[style] {
        /// Global/shared contacts.
        &, /._1S7ke { c: 0 0 bg5 }

        /// Avatars/images/new group/shared contacts/contact avatar.
        &, > img, /._18cLH, /._3_Hvt, /._2H1bg, /._1S7ke, /._2SNSv {
            rad: var(--r-avatars) i
        }

        /// Add rounded corners to the default group SVG avatar.
        /.Ao0On { c: 0 0 bg5 }

        /// Fix 'new group' bottom divider to hide drawer background-color.
        /._1g1ui > ._1ByLM { margin-left: unset i }

        /// Tweak default-user icons.
        if (radius-a != '50%') {
            /[style *= 'width:'][style *= 'height:'] {
                [data-icon = 'default-user'] svg {
                    margin-top: -4px i
                    transform: scale(0.7) i
                }
            }
        }
    }

    // Emojis -> Custom enhancements.
    .emojik {
        transition: transform 0.15s ease i

        /// Default opacity.
        &:not(:hover):not(:focus):not(.selected) {
            filter: opacity(var(--emoji-o))
        }

        /// Hovered/focused states.
        &:hover:not(.selected):not(:focus) {
            transform: scale(1.2)
            box-shadow: none i
            opacity: 1 i
        }

        /// Selected state. #148
        &.selected, &:focus { box-shadow: 0 0 0 1px bg3, 0 0 0 3px ac0 i }
    }

    // Modals.
    .overlay {
        /// Media/Avatar viewers have different headers. @upstream
        ._2ouPw, ._21ltg, > .KeLEe {
            border-bottom: 1px solid bg5 i
            c: 0 0 bg3

            /// Fix header onflicts.
            ../ ._1kEVs { c: 0 0 t }
        }

        /// Add borders.
        [data-animate-modal-popup] {
            border: 1px solid bg5
            rad: var(--r-menus) i

            .copyable-area > header {
                border-bottom: 1px solid bg5
            }
        }

        /// Fix media selection.
        /._1KWct { c: 0 bg5 bg3 }

        /// Status area modal.
        /[data-animate-status-v3-modal-background = 'true'] {
            c: 0 0 var(--modal-backdrop)
            /// Main content.
            > div {
                c: 0 0 bg1

                /// Sidebar.
                > div:nth-child(1) {
                    c: 0 0 bg2
                    border-right: 1px solid bg5
                    rad: var(--r-menus) 0 0 var(--r-menus) i
                }

                /// Large screens.
                if (!fullscreen) {
                    @media (min-width: 1441px) {
                        border: 1px solid bg5 i
                        rad: var(--r-menus) i
                    }
                }
            }

            /// Background color for author & publish date. @upstream
            /._2yhFa {
                margin: auto
                padding: 5px 8px 8px
                min-width: 150px
                rad: var(--r-inputs)
                background-color: to_rgba('bg-1', 0.5)
            }

            /// Fill color for unread icon. @upstream
            /[data-icon = 'status-v3-unread'] {
                [fill = '#009588'] { fill: ac0 i }
            }
        }

        /// 'Allow notifications' modal.
        &._3Os9f {
            c: 0 0 var(--modal-backdrop)
            [data-animate-modal-popup] {
                padding: 16px i
                c: 0 0 bg1

                /// Fix icon color.
                [data-icon = 'back'] path { fill: fg1 i }

                /// Uniform look with other modals. @upstream
                --white-rgb: var(--fg-2-rgb)
            }
        }
    }

    // Loading page.
    [id *= 'startup'] {
        c: 0 0 bg0

        /// Progress bar.
        /progress {
            c: 0 0 bg2
            &[value]::-moz-progress-bar { c: 0 0 ac0 }
            /::-moz-progress-bar { c: 0 0 bg4 }
            /::-webkit-progress {
                &-bar { c: 0 0 bg4 }
                &-value { c: 0 0 ac0 }
            }
        }
    }

    // Login page.
    .landing {
        &-wrapper::before { content: unset i }
        &-header {
            position: relative

            /// WhatsApp logo.
            path[fill ^= '#FFF'] { fill: ac0 }
            path[fill ^= '#00E'] { fill: bg1 }
            div {
                text-transform: unset
                c: fg1
            }

            /// Userstyle version.
            &::after {
                font-size: 14px
                font-weight: 500
                position: absolute
                content: var(--version)
                /html[dir = 'RTL'] & { left: 0 }
                /html[dir = 'LTR'] & { right: 0 }
            }
        }

        &-window:not(#z) {
            rad: 4px
            c: 0 0 bg1
            box-shadow: 0 0 1px bg5
        }

        &-main {
            a[href] { c: ac0 }
            label, ._2yUXW { c: fg3 }
            .landing-title { c: fg1 }
            rect[fill ^= '#f2f'], rect[fill ^= '#F2F'] { fill: bg5 }
            path[fill ^= '#818'] { fill: ac0 }

            /// QR code.
            div[data-ref] {
                rad: 0 i
                filter: contrast(150%)
                outline: 4px solid #fff
                box-shadow: 0 0 0 4px #fff
                [role='button'] { c: white 0 ac0 }

                /// Change white border when inactive.
                &._2BIlf {
                    outline: 4px solid ac0
                    box-shadow: 0 0 0 4px ac0
                }
            }

            /// Video tutorial.
            + ._3pdvT {
                c: 0 0 t
                img { opacity: 0.3 }
                /// Reset background on button container.
                [style *= 'opacity: 1'] { c: 0 0 t }
            }

            /// 'Keep me signed in' tooltip. #59
            ._3ybl8 {
                c: white 0 ac0
                box-shadow: bsh
                &::before { border-bottom-color: ac0 i }
            }
        }
    }

    // App background/misc styles.
    #app > div {
        // Feat -> App background.
        &::after {
            if ( app_image != none && app_image != default ) {
                s = var(--bg-blur-s)
                b = blur(var(--bg-blur))
                o = opacity(var(--bg-opacity))
                t = invert(var(--bg-invert))
                h = hue-rotate(var(--bg-hue))
                top: s; right: s; bottom: s; left: s;
                height: unset; width: unset;
                filter: b o t h
                background-color: transparent i
                background-position: var(--bg-pos) i
                background-image: var(--bg-image) i
                background-repeat: var(--bg-rep) i
                background-size: var(--bg-size) i
                content: '' i
            } else if ( app_image == default ) {
                content: '' i
                c: 0 0 bg1
            } else {
                display: none
            }
            /// Remove image in fullscreen mode.
            if (fullscreen) { content: none i }
        }

        /// Right -> Remove top border from the first Links/Docs message.
        /div, /span {
            div:first-child > .aGjYp::before { content: none }
        }

        /// Feat -> Input border radius.
        ._3xpD_ { rad: var(--r-inputs) i }

        /// Dropdowns -> Chat/Header.
        > span > div, ._2s_eZ {
            &[style ^= 'transform-origin:'][tabindex] {
                border: 1px solid bg4
                rad: var(--r-menus) i
            }
        }

        /// Floating emoji picker.
        > span > ._2I2_W {
            rad: var(--r-menus) i
            > ._3G19M {
                border: 1px solid bg5 i
                rad: var(--r-menus) i
            }
        }
    }

    // Shared app styles.
    #app > div > [tabindex] {
        c: 0 0 bg1

        @media (min-width: 1441px) {
            /// Feat -> Fullscreen mode.
            if (fullscreen) {
                &, /[data-animate-status-v3-modal-background] > div:first-child {
                    width: 100% i
                    max-width: 100% i
                    height: 100% i
                    top: unset i
                }
            } else {
                /// Feat -> Custom width for app/status areas.
                &, /[data-animate-status-v3-modal-background] > div:first-child {
                    width: calc(100% - 38px) i
                    max-width: var(--app-width) i
                    rad: var(--r-menus) i
                    border: 1px solid bg5 i
                    box-shadow: var(--bshadow) i
                }
            }
        }

        /// Odd header-like tall background.
        &::after { content: unset i }

        /// Search.
        .gQzdc, ._3qx7_ {
            border-bottom: 1px solid bg5 i
            &::after { display: none i }

            /// Align 'loading results' spinner inside input.
            ._1pp2N { padding-right: 5px }

            /// Remove animation.
            /._1yO24 { animation: none i }
        }

        /// Left -> Resets.
        #side {
            > header {
                border-bottom: 1px solid bg5 i

                /// Alerts.
                + span > div {
                    /// Close icon for 'low battery' state.
                    [data-icon = 'x'] svg path { fill: fg5 }

                    /// Feat -> Alerts.
                    if (alerts == 'hide') {
                        & > div { display: none i }
                    } else if (alerts == 'notifications') {
                        & > div {
                            border-bottom: 1px solid bg5 i
                            &._1evad { display: none i }
                        }
                    } else {
                        border-bottom: 1px solid bg5 i
                    }
                }
            }
        }

        /// Right -> Drawer divider.
        ._14VS3 > ._1V8rX {
            border-left: 1px solid bg5 i

            /// Drawer header.
            if (app_c_h) {
                .copyable-area > header {
                    border-bottom: 1px solid bg5 i
                }
            }

            /// Remove shadows from drawer sections.
            /._2Bps4 { box-shadow: 0 0 0 1px bg4 i }

            /// Remove native dark mode dividers.
            /.dark .three {
                ._2vJ01, ._2-aNW { border-right: none i }
            }
        }
    }

    // Global -> Icons.
    span[class] {
        /// Right -> Contact/group selected media drawer.
        &[data-icon = 'checkbox-round-checked'] {
            [fill = '#00BFA5'] { fill: ac0 }
            [fill = '#FFF'] { fill: white }
        }

        /// Chat -> Context menu arrows.
        &[data-icon = 'down-context'] { c: fg0 }

        /// Hover animation for icons.
        /#side > header,
        /#main > div + header,
        /#main > footer > .copyable-area,
        /.copyable-area > header {
            button:not([data-animate-menu-icons-item]), [role = 'button'] {
                [data-icon] { transition: fill-opacity 0.3s ease i }
                &:not(._3QjfB):hover [data-icon] { fill-opacity: 0.6 i }
            }
        }
    }

    /// Feat -> Consistent drawer headers.
    if(app_c_h) {
        ._1fiOp, ._2TZYF {
            height: 59px i
            justify-content: center i
            border-bottom: 1px solid bg5 i

            /// Reset left drawer inner item.
            > [data-animate-drawer-title] { height: unset i }

            /// Reset header text.
            ._3vTfY {
                margin-top: 1px i
                font-size: 18px i
                font-weight: normal i
            }
        }
    } else {
        ._1fiOp, ._2TZYF {
            --panel-background-colored: bg4 i
        }
    }

    /// Sidebar.
    #side {
        /// Feat -> Blur contacts.
        if (chat_b_c) {
            [style *= '0s; height'] {
                /// Remove odd shadow.
                > [aria-selected = 'true'] {
                    > div::after { display: none i }
                }

                /// Do the blur.
                > :not([aria-selected = 'true']) {
                    overflow: hidden i
                    > div { transition: background, filter 300ms ease-in-out i }
                    &:not(:hover) > div { filter: blur(6px) }
                    &._1f1zm, &:hover { filter: blur(0px) }
                }
            }
        }
    }

    // Chat.
    #main {
        /// Reset header.
        > header {
            border-bottom: 1px solid bg5 i
            border-right: none i
            c: 0 bg5

            /// Hide borders.
            &::after { content: unset i }
        }

        /// System messages.
        ._1E1g0 {
            border: 1px solid to_rgba('fg-1', 0.3)

            /// Tweak text shadow.
            text-shadow: 0 1px 0 to_rgba('fg-1', 0.3)

            /// End-to-end encryption message.
            &._2n04H { border: 1px solid to_rgba('notification-e2e-text', 0.3) }

            /// Bussiness account message.
            &._2nH_- { border: 1px solid to_rgba('notification-biz-text', 0.3) }
        }

        /// Loading previous messages.
        ._2J60S { border: 1px solid bg5 }

        /// Feat -> Custom chat background.
        /[data-asset-chat-background-dark], /[data-asset-chat-background-light] {
            filter: invert(var(--chat-bg-i)) opacity(var(--chat-bg-o))
            background-image: var(--chat-image) i
            background-position: var(--chat-bg-p) i
            background-repeat: var(--chat-bg-r) i
            background-size: var(--chat-bg-s) i
            opacity: 1 i

            /// Feat -> Show chat image.
            if (!chat_bg) { display: none i }
        }

        /// Tweak text shadow.
        ._1E1g0 { text-shadow: 0 1px 0 to_rgba('fg-3', 0.2) }

        /// Tweak 'unread messages' alert.
        ._9WQEN { border: none i }

        /// Tweak box-shadow for message bubbles.
        [class *= 'message-'][data-id] {
            /// Exclude stickers.
            > span + div:not(.urabC) > div {
                box-shadow: 0 1px 0 to_rgba('shadow', 0.33) i
            }
        }

        /// Fix context menu background for stickers.
        .-AOZp ._2oA-- + div[style] { c: 0 0 bg4 }

        /// Add background to media message timestamps.
        /[style *= 'width'][style *= 'height'] + div {
            /// Images.
            &._3yTyY, &._2CHFo {
                padding: 2px 4px i
                background-color: to_rgba('bg-1', 0.7) i
                rad: (tail_style == 'fb-like') ? 16px i : 5px i
            }

            /// Videos.
            /.video-thumb {
                /// Length/Timestamp.
                .len7M, + ._2DfqO {
                    padding: 2px 4px i
                    background-color: to_rgba('bg-1', 0.7) i
                    rad: (tail_style == 'fb-like') ? 16px i : 5px i
                }

                /// Timestamps in grouped media.
                &._3EMsd + ._2DfqO {
                    right: 5px i
                    bottom: 3px i
                }
            }
        }

        /// Feat -> Blur images/videos.
        if (chat_b_img) {
            /[class *= 'message-'] [style *= 'height'] {
                img {
                    transition: 0.5s ease
                    transition-delay: var(--blur-out)
                    filter: blur(16px) grayscale(100%)

                    &:hover {
                        transition-delay: var(--blur-in)
                        filter: none i
                    }
                }

                /// Reset blur for avatars in audio messages.
                &[style *= 'width'] > img._2goTk { filter: none i }
            }

            /[class *= 'message-'] .video-thumb {
                [style *= "data:image"] {
                    transition: 0.5s ease
                    transition-delay: var(--blur-out)
                    filter: blur(16px) grayscale(100%)
                }

                &:hover [style *= "data:image"] {
                    transition-delay: var(--blur-in)
                    filter: none i
                }
            }
        }

        /// Footer.
        > footer {
            /// Compose border.
            ../> header ~ div[style *= 'height: 0px'] {
                border-top: 1px solid bg5 i
            }

            /// Popover border.
            .velocity-animating,
            div[style $= 'translateY(0%);'],
            div[style $= 'translateY(0px);'] {
                box-shadow: 0 -1px 0 bg5 i
            }

            /// Remove double-border from an unknown contact.
            ._2k-2Z { border-top: none }

            /// Groups -> Only admins can send messages.
            ._3ge3i {
                border-top: 1px solid bg5 i
                border-left: @border-top
            }

            /// Emoji quick-picker.
            [data-list-scroll-container] {
                border-bottom: 1px solid bg5 i
                box-shadow: 0 -1px bg5 i
            }

            /// Chat -> Select messages.
            + span > ._2pAWd {
                border-top: 1px solid bg5 i
                border-left: 1px solid bg5 i
            }

            /// Emoji group selection.
            ._3eShu { border-bottom: 1px solid bg5 i }

            /// Feat -> Input border radius.
            ._3uMse { rad: var(--r-inputs) i }
        }

        /// Fix unread messages in dark mode. @upstream
        /.dark ._8Uqu5 ._3dtfX .m61XR { c: var(--secondary-stronger) }
    }

    /// Feat -> Colors for replies and group members.
    if (c_g_c) {
        :not(#z) .color {
            &-0  { c: blue }
            &-1  { c: cyan }
            &-2  { c: green }
            &-3  { c: violet }
            &-4  { c: magenta }
            &-5  { c: red }
            &-6  { c: orange }
            &-7  { c: yellow }
            &-8  { c: blue; filter: hue-rotate(20deg) }
            &-9  { c: cyan; filter: hue-rotate(20deg) }
            &-10 { c: green; filter: hue-rotate(20deg) }
            &-11 { c: violet; filter: hue-rotate(20deg) }
            &-12 { c: magenta; filter: hue-rotate(20deg) }
            &-13 { c: red; filter: hue-rotate(20deg) }
            &-14 { c: orange; filter: hue-rotate(20deg) }
            &-15 { c: blue; filter: hue-rotate(40deg) }
            &-16 { c: cyan; filter: hue-rotate(40deg) }
            &-17 { c: green; filter: hue-rotate(40deg) }
            &-18 { c: violet; filter: hue-rotate(40deg) }
            &-19 { c: magenta; filter: hue-rotate(40deg) }
            &-20 { c: red; filter: hue-rotate(40deg) }
        }
        :not(#z) .bg-color {
            &-0  { c: 0 0 blue }
            &-1  { c: 0 0 cyan }
            &-2  { c: 0 0 green }
            &-3  { c: 0 0 violet }
            &-4  { c: 0 0 magenta }
            &-5  { c: 0 0 red }
            &-6  { c: 0 0 orange }
            &-7  { c: 0 0 yellow }
            &-8  { c: 0 0 blue; filter: hue-rotate(20deg) }
            &-9  { c: 0 0 cyan; filter: hue-rotate(20deg) }
            &-10 { c: 0 0 green; filter: hue-rotate(20deg) }
            &-11 { c: 0 0 violet; filter: hue-rotate(20deg) }
            &-12 { c: 0 0 magenta; filter: hue-rotate(20deg) }
            &-13 { c: 0 0 red; filter: hue-rotate(20deg) }
            &-14 { c: 0 0 orange; filter: hue-rotate(20deg) }
            &-15 { c: 0 0 blue; filter: hue-rotate(40deg) }
            &-16 { c: 0 0 cyan; filter: hue-rotate(40deg) }
            &-17 { c: 0 0 green; filter: hue-rotate(40deg) }
            &-18 { c: 0 0 violet; filter: hue-rotate(40deg) }
            &-19 { c: 0 0 magenta; filter: hue-rotate(40deg) }
            &-20 { c: 0 0 red; filter: hue-rotate(40deg) }
        }
    }

    // Feat -> Compact mode.
    if (app_c_m) {
        /// Reset height/width if there is an overflow.
        #app > div > [tabindex] {
            @media screen and (max-height: 500px) { min-height: auto }
            @media screen and (max-width: 648px) { min-width: auto }
            // > div *:hover { box-shadow: inset 0 0 0 1px crimson i }
        }
        /// Compact mode.
        @media screen and (max-width: app_c_m_w) {
            .two, .three {
                /// Left -> Settings/Contacts.
                > div:nth-child(3) {
                    flex: 0 0 80px i
                    transition: 0.2s ease
                    &:hover, &:focus-within { flex: 0 0 30% i }
                }
            }
            .two {
                /// Reset upload preview.
                >  div:nth-child(2) > div:nth-child(2) {
                    flex: 0 0 calc(100% - 80px) i
                    margin-left: calc(-30% + 80px)
                }
                /// Expand contacts.
                > div:nth-child(3) {
                    min-width: 1px i
                    transition: 0.3s ease i
                    transition-delay: var(--c-m-delay) i
                    /// All left panes should be the same width.
                    &:hover {
                        min-width: 349px i
                        transition-delay: var(--c-m-hover) i
                        flex: 0 0 30% i
                    }
                }
                /// Settings/Starred/Archived panes.
                > :nth-child(2) > :nth-child(1) {
                    z-index: 201 i
                    flex: 0 0 30% i
                    min-width: 350px i
                    [style][tabindex] { border-right: 1px solid bg5 i }
                }
            }
            .three {
                /// Reset upload preview.
                > div:nth-child(2) > div:nth-child(2) {
                    flex: 0 0 calc(100% - 30% - 80px) i
                    margin-left: calc(-30% + 80px)
                }
                /// Reset chat when info is open.
                > div:nth-child(4) {
                    flex: 0 0 calc(100% - 30% - 80px) i
                }
                /// Do not expand left pane when right pane is open.
                > div:nth-child(3):hover { flex: 0 0 80px i }
                /// Tweaks for left and right panes.
                ._14VS3, ._1xXdX {
                    flex: 0 0 30% i
                    c: 0 t
                }
            }
            /// Fix search bar width.
            ._3qx7_:not(._3fVV4) label { padding: 0px }
            /// Contacts.
            #side {
                /// Fix header width.
                > header {
                    min-width: 240px
                    /// Hide notifications.
                    + span { display: none }
                }
                /// Items.
                .eJ0yJ {
                    /// Add whitespace to hide message content.
                    > div:last-child { padding-left: 5px i }
                    /// Reverse message content.
                    ._1582E {
                        position: relative
                        flex-direction: row-reverse i
                        /// Remove margin from status wrapper.
                        .m61XR {
                            z-index: 999 i
                            margin-left: 0 i
                            position: absolute
                            left: -41px
                            bottom: -6px
                            rad: 50%
                            ._15G96 { margin: 0 }
                            /// Unread messages indicator.
                            ._31gEB { border: 4px solid bg2 }
                        }
                        /// Reverse message and icons.
                        .m61XR > span {
                            display: flex i
                            flex-direction: row-reverse i
                        }
                        /// Remove chevron icon and all status icons.
                        ._38QnI, .ZKn2B > *:not(._31gEB) { display: none }
                    }
                    /// Typing indicator status.
                    /._616fG {
                        overflow: unset i
                        margin-top: -8px i
                        margin-left: 0px i
                        position: absolute i
                        &::before {
                            content: '' i
                            z-index: 1 i
                            position: absolute i
                            top: -31px i
                            left: -71px i
                            height: 53px i
                            width: 53px i
                            rad: var(--r-avatars) i
                            box-shadow: inset 0 0 0 3px green i
                            animation: 2s pulse infinite i
                        }
                    }
                    /// Message status.
                    .zFnXi {
                        padding: 1.5px
                        z-index: 101
                        position: absolute
                        margin: -2px 0 0 -75px
                        border: 3px solid bg2
                        c: 0 0 bg1
                        rad: 50%
                        /// Make SVG smaller.
                        > span > svg {
                            padding: 2px
                            height: 14px i
                            width: 14px i
                        }
                    }
                    /// Active states.
                    &._13opk { ._31gEB, .zFnXi { c: 0 bg4 }}
                    &:hover:not(._13opk) { ._31gEB, .zFnXi { c: 0 bg3 }}
                }
                /// I _think_ I understand why this works!
                ._2kHpK { min-width: 80px i }
            }
        }
    }

    // Main -> Chat message bubbles.
    .message {
        /// 1, 2:    External video/link
        /// 3, 4, 5: Reply, Gif, Document
        /// 6, 7:    Grouped image/video
        md = '._1t3gq, .SjSeX, ._2iML2, ._15rLL, ._3_4_I, .Yik3W, .va0ao'
        /// 1:   Messages
        /// 2:   Videos
        /// 3-5: Images/gifs/stickers
        ts = '.VGBA3, .video-thumb + ._2DfqO, ._3yTyY, ._2CHFo, ._1nrJA'

        /// Feat -> Message tails.
        if (tail_style == 'fb-like') {
            _o = 16px
            _m = (16px - 2px)
            _i = 6px

            /// Feat -> Incoming message bubble position.
            if (!bubble_in) {
                left_top = _o _o _o _i i
                left_mid = _i _o _o _i i
                left_med = _i _m _m _i i
                left_end = _i _o _o _o i
            } else {
                left_top = _o _o _i _o i
                left_mid = _o _i _i _o i
                left_med = _m _i _i _m i
                left_end = _o _i _o _o i
            }

            /// Feat -> Outgoing message bubble position.
            if (!bubble_out) {
                right_top = _o _o _i _o i
                right_mid = _o _i _i _o i
                right_med = _m _i _i _m i
                right_end = _o _i _o _o i
            } else {
                right_top = _o _o _o _i i
                right_mid = _i _o _o _i i
                right_med = _i _m _m _i i
                right_end = _i _o _o _o i
            }

            /// Helpers.
            bubble  = '._28DtS'
            system  = '._2qhWD, ._9WQEN'
            sticker = '._3ToB1'
            forward = '._29g--'

            /// Shared styles.
            &-in, &-out {
                /// Remove tails.
                [data-icon *= 'tail-'] { display: none i }

                /// Single message | Groups -> Sticker sender.
                &:not({ bubble }) > div > div { rad: _o i }
                &:not({ bubble }) { sticker } { rad: _o i }

                /// Fix rounded corners for single message.
                &:not({ bubble }) { md } { rad: _o i }

                /// Fix rounded corners for forward button.
                &:not(#z) { forward }:not(#z) { rad: _o i }

                /// Fix rounded corners for videos/images in grouped media.
                &:not(#z) ._269XL._3sKvP.wQZ0F { .va0ao, .Yik3W { rad: _o i }}

                /// Increase padding-right for bubbles.
                &:not(.serpP) ._274yw {
                    padding-right: 9px i

                    /// Fix margin for replies.
                    ._3AFCK { margin-right: -6px }
                }

                /// Rounded timestamps.
                { ts } { rad: 18px i }
            }

            /// Incoming messages.
            &-in {
                ._1ohds { border-top-right-radius: _m i }
                /// First message -> In/Out/System messages.
                &, ../-out, /{ system } {
                    &:not({ bubble }) + .message-in{ bubble } {
                        // c: 0 0 #ff55550a
                        > div > div, { md }, { sticker } { rad: left_top }
                        /// Media context menu.
                        ._20EE3 { rad: 0 _m 0 0 i }
                    }
                }
                /// Messages in between.
                &{ bubble } + { bubble }:not(#z) {
                    // c: 0 0 #55ff550a
                    { md } { rad: left_med }
                    > div > div, { sticker } { rad: left_mid }
                }
                /// Last message.
                &{ bubble } + .message-in:not({ bubble }) {
                    // c: 0 0 #5555ff0a
                    > div > div, { md }, { sticker } { rad: left_end }
                }

                /// Feat -> Incoming message bubble position.
                if (bubble_in) { align-items: flex-end i }
            }

            /// Outgoing messages.
            &-out {
                ._1ohds { border-top-right-radius: _o i }
                /// First message -> In/Out/System messages.
                &, ../-in, /{ system } {
                    &:not({ bubble }) + .message-out{ bubble } {
                        // c: 0 0 #ff55551a;
                        > div > div, { md } { rad: right_top }
                        /// Media context menu.
                        ._20EE3 { rad: 0 _m 0 0 i }
                    }
                }
                /// Messages in between.
                &{ bubble } + { bubble } {
                    // c: 0 0 #55ff551a;
                    { md } { rad: right_med }
                    > div > div { rad: right_mid }
                    /// Context menu.
                    ._1ohds { border-top-right-radius: _i i }
                }
                /// Last message.
                &{ bubble } + .message-out:not({ bubble }) {
                    // c: 0 0 #5555ff1a;
                    > div > div, { md } { rad: right_end }
                }

                /// Feat -> Outgoing message bubble position.
                if (bubble_out) { align-items: flex-start i }
            }
        } else if (tail_style == 'rounded' || tail_style == 'minimal') {
            &-in, &-out {
                [data-icon *= 'tail'] {
                    display: none i
                    if (tail_style == 'rounded') {
                        /// 1:    First message
                        /// 2, 3: Sticker senders
                        + div { &, /._3ToB1, /._1nrJA { rad: 7.5px i }}
                    }
                }
            }
        }

        /// Feat -> Fixes for RTL message header. @upstream
        if (rtl_header) {
            &-in, &-out {
                .selectable-text.invisible-space[dir = 'rtl'],
                /// Some links have TWO empty headers.
                a.selectable-text[href],
                /// Embedded links are special snowflakes, too.
                .eRacY[dir = 'ltr'] > [dir = 'ltr'] {
                    &::before { content: unset i }
                }
            }
        }

        /// Feat -> Fixes for RTL message content. @upstream
        if (rtl_format) {
            &-in, &-out {
                [data-pre-plain-text] > [dir = 'rtl'] {
                    if (!rtl_header) { padding-top: 0.8rem i }
                    padding-bottom: 0.8rem i
                }
                .selectable-text.invisible-space[dir = 'rtl'] {
                    > span[class] { display: unset i }
                    @supports (-moz-user-select: none) {
                        &::before { content: unset i }
                    }
                }
                /// Apparently messages with images/videos are treated like
                /// special snowflakes, so this resets their timestamps.
                [style *= 'width'], .video-thumb {
                    + div > .eRacY[dir = 'rtl'] { padding-bottom: 0.8rem i }
                }
                /// Remove whitespace for links.
                .message-text-link::after { content: unset i }
            }
        }

        /// Feat -> Collapse messages for `fb-like` tail style and `RTL` tweaks.
        if (fb_compact && rtl_header && tail_style == 'fb-like') {
            rtl = '.eRacY[dir = "rtl"]'
            ltr = '._2oWZe'
            big = '._20sYJ'

            &-in, &-out {
                /// LTR whitespace.
                { ltr } {
                    display: block i
                    padding-top: 0.8rem
                }

                /// RTL whitespace.
                { rtl }, { big } {
                    position: relative
                    padding-bottom: 0.8rem i
                }

                /// Hide timemstamps.
                &._28DtS {
                    // c: 0 0 #ff555508
                    { rtl }, { ltr }, { big } { transition: padding 0.2s ease i }
                    { ts } { transition: opacity 0.2s ease i }

                    /// Collapse messages.
                    > div:not(:hover) {
                        { ts } { opacity: 0 i }
                        { rtl }, { big } { padding-bottom: 0rem i }
                        { ltr } { padding-top: 0rem i }
                    }

                    /// Expand 'hover' area.
                    ../ > div::before {
                        content: '' i
                        position: absolute i
                        top: 0; right: -20px; bottom: 0; left: -20px;
                        // ../../../-in > div::before { c: 0 0 #55ff5520 }
                        // ../../../-out > div::before { c: 0 0 #5555ff20 }
                    }
                }

                /// Feat -> Decrease height of big emojis.
                if (emoji_b) {
                    { big } {
                        margin: 0 i
                        padding-top: 2px i
                        z-index: 0 i

                        /// Reset emojis.
                        span {
                            margin: 0
                            > img { width: 20px i; height: @width }
                        }
                    }
                }
            }
        }
    }
}
